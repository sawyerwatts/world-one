#!/bin/bash

if [ -f ./.env ]; then
	source ./.env
else
	echo "./.env does not exist. Hopefully all the needed environment variables are exported from somewhere else"
fi

if [ -z $W1_PGHOST ]; then
	echo "Please define environment variable W1_PGHOST"
elif [ -z $PGUSER ]; then
	echo "Please define environment variable W1_PGUSER"
elif [ -z $PGPASSWORD ]; then
	echo "Please define environment variable W1_PGPASSWORD"
else
	export W1_PGURL="postgresql://$W1_PGUSER:$W1_PGPASSWORD@$W1_PGHOST/world_one?sslmode=disable"
	alias migrate='go run -tags "postgres" github.com/golang-migrate/migrate/v4/cmd/migrate@latest'
	# $ migrate create -ext sql -dir migrations -seq create_users_table
	# $ source ./env.sh; migrate -path sql/migrations/ -database $W1_PGURL up
	# If you need to force a certain version:
	# 	$ migrate -path migrations/ -database $PGURL force 1
fi

